"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.LensyStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const dynamodb = __importStar(require("aws-cdk-lib/aws-dynamodb"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const apigwv2 = __importStar(require("@aws-cdk/aws-apigatewayv2-alpha"));
const apigwv2_integrations = __importStar(require("@aws-cdk/aws-apigatewayv2-integrations-alpha"));
const sfn = __importStar(require("aws-cdk-lib/aws-stepfunctions"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const path = __importStar(require("path"));
class LensyStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // 1. S3 Bucket for Analysis
        const analysisBucket = new s3.Bucket(this, 'LensyAnalysisBucket', {
            bucketName: `lensy-analysis-951411676525-${this.region}`,
            encryption: s3.BucketEncryption.S3_MANAGED,
            removalPolicy: cdk.RemovalPolicy.RETAIN,
        });
        // 2. DynamoDB Tables
        const processedContentTable = new dynamodb.Table(this, 'ProcessedContentTableV3', {
            partitionKey: { name: 'url', type: dynamodb.AttributeType.STRING },
            sortKey: { name: 'contextualSetting', type: dynamodb.AttributeType.STRING },
            billingMode: dynamodb.BillingMode.PAY_PER_REQUEST,
            timeToLiveAttribute: 'ttl',
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        processedContentTable.addGlobalSecondaryIndex({
            indexName: 'ProcessedAtIndex',
            partitionKey: { name: 'processedAt', type: dynamodb.AttributeType.STRING },
        });
        const webSocketConnectionsTable = new dynamodb.Table(this, 'WebSocketConnectionsTable', {
            partitionKey: { name: 'connectionId', type: dynamodb.AttributeType.STRING },
            billingMode: dynamodb.BillingMode.PAY_PER_REQUEST,
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        webSocketConnectionsTable.addGlobalSecondaryIndex({
            indexName: 'SessionIdIndex',
            partitionKey: { name: 'sessionId', type: dynamodb.AttributeType.STRING },
        });
        // 3. WebSocket API
        const webSocketHandler = new lambda.Function(this, 'WebSocketHandlerFunction', {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: 'index.handler',
            code: lambda.Code.fromAsset(path.join(__dirname, '../lambda/websocket-handler')),
            timeout: cdk.Duration.seconds(30),
            environment: {
                WS_CONNECTIONS_TABLE: webSocketConnectionsTable.tableName,
            }
        });
        webSocketConnectionsTable.grantReadWriteData(webSocketHandler);
        const webSocketApi = new apigwv2.WebSocketApi(this, 'LensyWebSocketApi', {
            connectRouteOptions: { integration: new apigwv2_integrations.WebSocketLambdaIntegration('ConnectIntegration', webSocketHandler) },
            disconnectRouteOptions: { integration: new apigwv2_integrations.WebSocketLambdaIntegration('DisconnectIntegration', webSocketHandler) },
            defaultRouteOptions: { integration: new apigwv2_integrations.WebSocketLambdaIntegration('DefaultIntegration', webSocketHandler) },
        });
        const webSocketStage = new apigwv2.WebSocketStage(this, 'WebSocketStage', {
            webSocketApi,
            stageName: 'prod',
            autoDeploy: true,
        });
        webSocketApi.addRoute('subscribe', {
            integration: new apigwv2_integrations.WebSocketLambdaIntegration('SubscribeIntegration', webSocketHandler),
        });
        const wsEndpoint = `https://${webSocketApi.apiId}.execute-api.${this.region}.amazonaws.com/prod`;
        // 4. Functional Lambdas
        const commonEnv = {
            ANALYSIS_BUCKET: analysisBucket.bucketName,
            WEBSOCKET_API_ENDPOINT: wsEndpoint,
            CONNECTIONS_TABLE: webSocketConnectionsTable.tableName,
        };
        const createLambda = (id, dir, timeout = 30, memory = 128, env = {}) => {
            const fn = new lambda.Function(this, id, {
                runtime: lambda.Runtime.NODEJS_20_X,
                handler: 'index.handler',
                code: lambda.Code.fromAsset(path.join(__dirname, `../lambda/${dir}`)),
                timeout: cdk.Duration.seconds(timeout),
                memorySize: memory,
                environment: { ...commonEnv, ...env }
            });
            analysisBucket.grantReadWrite(fn);
            webSocketConnectionsTable.grantReadWriteData(fn);
            fn.addToRolePolicy(new iam.PolicyStatement({
                actions: ['execute-api:ManageConnections'],
                resources: [`arn:aws:execute-api:${this.region}:${this.account}:${webSocketApi.apiId}/prod/*`],
            }));
            return fn;
        };
        const inputTypeDetector = createLambda('InputTypeDetectorFunction', 'input-type-detector', 60);
        const sitemapParser = createLambda('SitemapParserFunction', 'sitemap-parser', 120);
        const sitemapHealthChecker = createLambda('SitemapHealthCheckerFunction', 'sitemap-health-checker', 300, 256);
        const urlProcessor = createLambda('URLProcessorFunction', 'url-processor', 120, 512);
        const structureDetector = createLambda('StructureDetectorFunction', 'structure-detector', 60);
        const dimensionAnalyzer = createLambda('DimensionAnalyzerFunction', 'dimension-analyzer', 300, 512, {
            PROCESSED_CONTENT_TABLE: processedContentTable.tableName,
            CACHE_TTL_DAYS: '7'
        });
        processedContentTable.grantReadWriteData(dimensionAnalyzer);
        dimensionAnalyzer.addToRolePolicy(new iam.PolicyStatement({
            actions: ['bedrock:InvokeModel'],
            resources: ['*'],
        }));
        const reportGenerator = createLambda('ReportGeneratorFunction', 'report-generator', 60, 256);
        const issueDiscoverer = createLambda('IssueDiscovererFunction', 'issue-discoverer', 120, 512, { S3_BUCKET_NAME: analysisBucket.bucketName });
        const issueValidator = createLambda('IssueValidatorFunction', 'issue-validator', 300, 1024, { S3_BUCKET_NAME: analysisBucket.bucketName });
        const fixGenerator = createLambda('FixGeneratorFunction', 'fix-generator', 300, 1024);
        const fixApplicator = createLambda('FixApplicatorFunction', 'fix-applicator', 300, 512);
        issueValidator.addToRolePolicy(new iam.PolicyStatement({
            actions: ['bedrock:InvokeModel'],
            resources: ['*'],
        }));
        fixGenerator.addToRolePolicy(new iam.PolicyStatement({
            actions: ['bedrock:InvokeModel'],
            resources: ['*'],
        }));
        // 5. Step Functions Workflow
        const definitionString = `{"StartAt":"DetectInputType","States":{"DetectInputType":{"Next":"InputTypeChoice","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","ResultPath":"$.inputTypeDetectorResult","Resource":"arn:aws:states:::lambda:invoke","Parameters":{"FunctionName":"${inputTypeDetector.functionArn}","Payload.$":"$"}},"InputTypeChoice":{"Type":"Choice","Choices":[{"Variable":"$.inputTypeDetectorResult.Payload.inputType","StringEquals":"sitemap","Next":"ParseSitemap"}],"Default":"ProcessURL"},"ProcessURL":{"Next":"DetectStructure","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","ResultPath":"$.urlProcessorResult","Resource":"arn:aws:states:::lambda:invoke","Parameters":{"FunctionName":"${urlProcessor.functionArn}","Payload.$":"$"}},"DetectStructure":{"Next":"AnalyzeDimensions","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","ResultPath":"$.structureDetectorResult","Resource":"arn:aws:states:::lambda:invoke","Parameters":{"FunctionName":"${structureDetector.functionArn}","Payload.$":"$"}},"AnalyzeDimensions":{"Next":"GenerateReport","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","ResultPath":"$.dimensionAnalyzerResult","Resource":"arn:aws:states:::lambda:invoke","Parameters":{"FunctionName":"${dimensionAnalyzer.functionArn}","Payload.$":"$"}},"GenerateReport":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","ResultPath":"$.reportGeneratorResult","Resource":"arn:aws:states:::lambda:invoke","Parameters":{"FunctionName":"${reportGenerator.functionArn}","Payload.$":"$"}},"CheckSitemapHealth":{"Next":"GenerateReport","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","ResultPath":"$.sitemapHealthCheckerResult","Resource":"arn:aws:states:::lambda:invoke","Parameters":{"FunctionName":"${sitemapHealthChecker.functionArn}","Payload.$":"$"}},"ParseSitemap":{"Next":"CheckSitemapHealth","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","ResultPath":"$.sitemapParserResult","Resource":"arn:aws:states:::lambda:invoke","Parameters":{"FunctionName":"${sitemapParser.functionArn}","Payload.$":"$"}}},"TimeoutSeconds":900}`;
        const stateMachine = new sfn.StateMachine(this, 'LensyAnalysisWorkflow', {
            definitionBody: sfn.DefinitionBody.fromString(definitionString),
            timeout: cdk.Duration.minutes(15),
        });
        // Grant Step Functions permission to invoke all Lambda functions
        inputTypeDetector.grantInvoke(stateMachine);
        sitemapParser.grantInvoke(stateMachine);
        sitemapHealthChecker.grantInvoke(stateMachine);
        urlProcessor.grantInvoke(stateMachine);
        structureDetector.grantInvoke(stateMachine);
        dimensionAnalyzer.grantInvoke(stateMachine);
        reportGenerator.grantInvoke(stateMachine);
        // 6. API Handler and HTTP API
        const apiHandler = createLambda('ApiHandlerFunction', 'api-handler', 30, 256, {
            STATE_MACHINE_ARN: stateMachine.stateMachineArn,
            ISSUE_DISCOVERER_FUNCTION_NAME: issueDiscoverer.functionName,
            ISSUE_VALIDATOR_FUNCTION_NAME: issueValidator.functionName,
            FIX_GENERATOR_FUNCTION_NAME: fixGenerator.functionName,
            FIX_APPLICATOR_FUNCTION_NAME: fixApplicator.functionName,
        });
        stateMachine.grantStartExecution(apiHandler);
        issueDiscoverer.grantInvoke(apiHandler);
        issueValidator.grantInvoke(apiHandler);
        fixGenerator.grantInvoke(apiHandler);
        fixApplicator.grantInvoke(apiHandler);
        const httpApi = new apigwv2.HttpApi(this, 'LensyHttpApi', {
            description: 'Lensy HTTP API',
            corsPreflight: {
                allowOrigins: ['*'],
                allowMethods: [apigwv2.CorsHttpMethod.GET, apigwv2.CorsHttpMethod.POST, apigwv2.CorsHttpMethod.OPTIONS],
                allowHeaders: ['Content-Type', 'X-Amz-Date', 'Authorization', 'X-Api-Key'],
                maxAge: cdk.Duration.days(10),
            },
        });
        const apiIntegration = new apigwv2_integrations.HttpLambdaIntegration('ApiHandlerIntegration', apiHandler);
        httpApi.addRoutes({ path: '/analyze', methods: [apigwv2.HttpMethod.POST], integration: apiIntegration });
        httpApi.addRoutes({ path: '/scan-doc', methods: [apigwv2.HttpMethod.POST], integration: apiIntegration });
        httpApi.addRoutes({ path: '/status/{sessionId}', methods: [apigwv2.HttpMethod.GET], integration: apiIntegration });
        httpApi.addRoutes({ path: '/discover-issues', methods: [apigwv2.HttpMethod.POST], integration: apiIntegration });
        httpApi.addRoutes({ path: '/validate-issues', methods: [apigwv2.HttpMethod.POST], integration: apiIntegration });
        httpApi.addRoutes({ path: '/generate-fixes', methods: [apigwv2.HttpMethod.POST], integration: apiIntegration });
        httpApi.addRoutes({ path: '/apply-fixes', methods: [apigwv2.HttpMethod.POST], integration: apiIntegration });
        // 7. Outputs
        new cdk.CfnOutput(this, 'HttpApiUrl', {
            value: httpApi.apiEndpoint,
            description: 'HTTP API Gateway URL',
        });
        new cdk.CfnOutput(this, 'WebSocketApiUrl', {
            value: webSocketStage.url,
            description: 'WebSocket API URL',
        });
        new cdk.CfnOutput(this, 'StateMachineArn', {
            value: stateMachine.stateMachineArn,
            description: 'Step Functions State Machine ARN',
        });
    }
}
exports.LensyStack = LensyStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGVuc3ktc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9sZW5zeS1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGlEQUFtQztBQUNuQyx1REFBeUM7QUFDekMsbUVBQXFEO0FBQ3JELCtEQUFpRDtBQUNqRCx5RUFBMkQ7QUFDM0QsbUdBQXFGO0FBQ3JGLG1FQUFxRDtBQUNyRCx5REFBMkM7QUFFM0MsMkNBQTZCO0FBRTdCLE1BQWEsVUFBVyxTQUFRLEdBQUcsQ0FBQyxLQUFLO0lBQ3JDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDNUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFeEIsNEJBQTRCO1FBQzVCLE1BQU0sY0FBYyxHQUFHLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUscUJBQXFCLEVBQUU7WUFDOUQsVUFBVSxFQUFFLCtCQUErQixJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ3hELFVBQVUsRUFBRSxFQUFFLENBQUMsZ0JBQWdCLENBQUMsVUFBVTtZQUMxQyxhQUFhLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFNO1NBQzFDLENBQUMsQ0FBQztRQUVILHFCQUFxQjtRQUNyQixNQUFNLHFCQUFxQixHQUFHLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUseUJBQXlCLEVBQUU7WUFDOUUsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUU7WUFDbEUsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLG1CQUFtQixFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRTtZQUMzRSxXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVcsQ0FBQyxlQUFlO1lBQ2pELG1CQUFtQixF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QUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7UUFDakgsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxPQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQ2hILE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7UUFFN0csYUFBYTtRQUNiLElBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFO1lBQ2xDLEtBQUssRUFBRSxPQUFPLENBQUMsV0FBVztZQUMxQixXQUFXLEVBQUUsc0JBQXNCO1NBQ3RDLENBQUMsQ0FBQztRQUVILElBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsaUJBQWlCLEVBQUU7WUFDdkMsS0FBSyxFQUFFLGNBQWMsQ0FBQyxHQUFHO1lBQ3pCLFdBQVcsRUFBRSxtQkFBbUI7U0FDbkMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxpQkFBaUIsRUFBRTtZQUN2QyxLQUFLLEVBQUUsWUFBWSxDQUFDLGVBQWU7WUFDbkMsV0FBVyxFQUFFLGtDQUFrQztTQUNsRCxDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0o7QUEvTEQsZ0NBK0xDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIHMzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zMyc7XG5pbXBvcnQgKiBhcyBkeW5hbW9kYiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZHluYW1vZGInO1xuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xuaW1wb3J0ICogYXMgYXBpZ3d2MiBmcm9tICdAYXdzLWNkay9hd3MtYXBpZ2F0ZXdheXYyLWFscGhhJztcbmltcG9ydCAqIGFzIGFwaWd3djJfaW50ZWdyYXRpb25zIGZyb20gJ0Bhd3MtY2RrL2F3cy1hcGlnYXRld2F5djItaW50ZWdyYXRpb25zLWFscGhhJztcbmltcG9ydCAqIGFzIHNmbiBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc3RlcGZ1bmN0aW9ucyc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBjbGFzcyBMZW5zeVN0YWNrIGV4dGVuZHMgY2RrLlN0YWNrIHtcbiAgICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IGNkay5TdGFja1Byb3BzKSB7XG4gICAgICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuXG4gICAgICAgIC8vIDEuIFMzIEJ1Y2tldCBmb3IgQW5hbHlzaXNcbiAgICAgICAgY29uc3QgYW5hbHlzaXNCdWNrZXQgPSBuZXcgczMuQnVja2V0KHRoaXMsICdMZW5zeUFuYWx5c2lzQnVja2V0Jywge1xuICAgICAgICAgICAgYnVja2V0TmFtZTogYGxlbnN5LWFuYWx5c2lzLTk1MTQxMTY3NjUyNS0ke3RoaXMucmVnaW9ufWAsXG4gICAgICAgICAgICBlbmNyeXB0aW9uOiBzMy5CdWNrZXRFbmNyeXB0aW9uLlMzX01BTkFHRUQsXG4gICAgICAgICAgICByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5SRVRBSU4sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIDIuIER5bmFtb0RCIFRhYmxlc1xuICAgICAgICBjb25zdCBwcm9jZXNzZWRDb250ZW50VGFibGUgPSBuZXcgZHluYW1vZGIuVGFibGUodGhpcywgJ1Byb2Nlc3NlZENvbnRlbnRUYWJsZVYzJywge1xuICAgICAgICAgICAgcGFydGl0aW9uS2V5OiB7IG5hbWU6ICd1cmwnLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxuICAgICAgICAgICAgc29ydEtleTogeyBuYW1lOiAnY29udGV4dHVhbFNldHRpbmcnLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxuICAgICAgICAgICAgYmlsbGluZ01vZGU6IGR5bmFtb2RiLkJpbGxpbmdNb2RlLlBBWV9QRVJfUkVRVUVTVCxcbiAgICAgICAgICAgIHRpbWVUb0xpdmVBdHRyaWJ1dGU6ICd0dGwnLFxuICAgICAgICAgICAgcmVtb3ZhbFBvbGljeTogY2RrLlJlbW92YWxQb2xpY3kuREVTVFJPWSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcHJvY2Vzc2VkQ29udGVudFRhYmxlLmFkZEdsb2JhbFNlY29uZGFyeUluZGV4KHtcbiAgICAgICAgICAgIGluZGV4TmFtZTogJ1Byb2Nlc3NlZEF0SW5kZXgnLFxuICAgICAgICAgICAgcGFydGl0aW9uS2V5OiB7IG5hbWU6ICdwcm9jZXNzZWRBdCcsIHR5cGU6IGR5bmFtb2RiLkF0dHJpYnV0ZVR5cGUuU1RSSU5HIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHdlYlNvY2tldENvbm5lY3Rpb25zVGFibGUgPSBuZXcgZHluYW1vZGIuVGFibGUodGhpcywgJ1dlYlNvY2tldENvbm5lY3Rpb25zVGFibGUnLCB7XG4gICAgICAgICAgICBwYXJ0aXRpb25LZXk6IHsgbmFtZTogJ2Nvbm5lY3Rpb25JZCcsIHR5cGU6IGR5bmFtb2RiLkF0dHJpYnV0ZVR5cGUuU1RSSU5HIH0sXG4gICAgICAgICAgICBiaWxsaW5nTW9kZTogZHluYW1vZGIuQmlsbGluZ01vZGUuUEFZX1BFUl9SRVFVRVNULFxuICAgICAgICAgICAgcmVtb3ZhbFBvbGljeTogY2RrLlJlbW92YWxQb2xpY3kuREVTVFJPWSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd2ViU29ja2V0Q29ubmVjdGlvbnNUYWJsZS5hZGRHbG9iYWxTZWNvbmRhcnlJbmRleCh7XG4gICAgICAgICAgICBpbmRleE5hbWU6ICdTZXNzaW9uSWRJbmRleCcsXG4gICAgICAgICAgICBwYXJ0aXRpb25LZXk6IHsgbmFtZTogJ3Nlc3Npb25JZCcsIHR5cGU6IGR5bmFtb2RiLkF0dHJpYnV0ZVR5cGUuU1RSSU5HIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIDMuIFdlYlNvY2tldCBBUElcbiAgICAgICAgY29uc3Qgd2ViU29ja2V0SGFuZGxlciA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgJ1dlYlNvY2tldEhhbmRsZXJGdW5jdGlvbicsIHtcbiAgICAgICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxuICAgICAgICAgICAgaGFuZGxlcjogJ2luZGV4LmhhbmRsZXInLFxuICAgICAgICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9sYW1iZGEvd2Vic29ja2V0LWhhbmRsZXInKSksXG4gICAgICAgICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24uc2Vjb25kcygzMCksXG4gICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgIFdTX0NPTk5FQ1RJT05TX1RBQkxFOiB3ZWJTb2NrZXRDb25uZWN0aW9uc1RhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHdlYlNvY2tldENvbm5lY3Rpb25zVGFibGUuZ3JhbnRSZWFkV3JpdGVEYXRhKHdlYlNvY2tldEhhbmRsZXIpO1xuXG4gICAgICAgIGNvbnN0IHdlYlNvY2tldEFwaSA9IG5ldyBhcGlnd3YyLldlYlNvY2tldEFwaSh0aGlzLCAnTGVuc3lXZWJTb2NrZXRBcGknLCB7XG4gICAgICAgICAgICBjb25uZWN0Um91dGVPcHRpb25zOiB7IGludGVncmF0aW9uOiBuZXcgYXBpZ3d2Ml9pbnRlZ3JhdGlvbnMuV2ViU29ja2V0TGFtYmRhSW50ZWdyYXRpb24oJ0Nvbm5lY3RJbnRlZ3JhdGlvbicsIHdlYlNvY2tldEhhbmRsZXIpIH0sXG4gICAgICAgICAgICBkaXNjb25uZWN0Um91dGVPcHRpb25zOiB7IGludGVncmF0aW9uOiBuZXcgYXBpZ3d2Ml9pbnRlZ3JhdGlvbnMuV2ViU29ja2V0TGFtYmRhSW50ZWdyYXRpb24oJ0Rpc2Nvbm5lY3RJbnRlZ3JhdGlvbicsIHdlYlNvY2tldEhhbmRsZXIpIH0sXG4gICAgICAgICAgICBkZWZhdWx0Um91dGVPcHRpb25zOiB7IGludGVncmF0aW9uOiBuZXcgYXBpZ3d2Ml9pbnRlZ3JhdGlvbnMuV2ViU29ja2V0TGFtYmRhSW50ZWdyYXRpb24oJ0RlZmF1bHRJbnRlZ3JhdGlvbicsIHdlYlNvY2tldEhhbmRsZXIpIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHdlYlNvY2tldFN0YWdlID0gbmV3IGFwaWd3djIuV2ViU29ja2V0U3RhZ2UodGhpcywgJ1dlYlNvY2tldFN0YWdlJywge1xuICAgICAgICAgICAgd2ViU29ja2V0QXBpLFxuICAgICAgICAgICAgc3RhZ2VOYW1lOiAncHJvZCcsXG4gICAgICAgICAgICBhdXRvRGVwbG95OiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgICAgICB3ZWJTb2NrZXRBcGkuYWRkUm91dGUoJ3N1YnNjcmliZScsIHtcbiAgICAgICAgICAgIGludGVncmF0aW9uOiBuZXcgYXBpZ3d2Ml9pbnRlZ3JhdGlvbnMuV2ViU29ja2V0TGFtYmRhSW50ZWdyYXRpb24oJ1N1YnNjcmliZUludGVncmF0aW9uJywgd2ViU29ja2V0SGFuZGxlciksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHdzRW5kcG9pbnQgPSBgaHR0cHM6Ly8ke3dlYlNvY2tldEFwaS5hcGlJZH0uZXhlY3V0ZS1hcGkuJHt0aGlzLnJlZ2lvbn0uYW1hem9uYXdzLmNvbS9wcm9kYDtcblxuICAgICAgICAvLyA0LiBGdW5jdGlvbmFsIExhbWJkYXNcbiAgICAgICAgY29uc3QgY29tbW9uRW52ID0ge1xuICAgICAgICAgICAgQU5BTFlTSVNfQlVDS0VUOiBhbmFseXNpc0J1Y2tldC5idWNrZXROYW1lLFxuICAgICAgICAgICAgV0VCU09DS0VUX0FQSV9FTkRQT0lOVDogd3NFbmRwb2ludCxcbiAgICAgICAgICAgIENPTk5FQ1RJT05TX1RBQkxFOiB3ZWJTb2NrZXRDb25uZWN0aW9uc1RhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBjcmVhdGVMYW1iZGEgPSAoaWQ6IHN0cmluZywgZGlyOiBzdHJpbmcsIHRpbWVvdXQgPSAzMCwgbWVtb3J5ID0gMTI4LCBlbnYgPSB7fSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZm4gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsIGlkLCB7XG4gICAgICAgICAgICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzIwX1gsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogJ2luZGV4LmhhbmRsZXInLFxuICAgICAgICAgICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCBgLi4vbGFtYmRhLyR7ZGlyfWApKSxcbiAgICAgICAgICAgICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24uc2Vjb25kcyh0aW1lb3V0KSxcbiAgICAgICAgICAgICAgICBtZW1vcnlTaXplOiBtZW1vcnksXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHsgLi4uY29tbW9uRW52LCAuLi5lbnYgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhbmFseXNpc0J1Y2tldC5ncmFudFJlYWRXcml0ZShmbik7XG4gICAgICAgICAgICB3ZWJTb2NrZXRDb25uZWN0aW9uc1RhYmxlLmdyYW50UmVhZFdyaXRlRGF0YShmbik7XG4gICAgICAgICAgICBmbi5hZGRUb1JvbGVQb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgICAgIGFjdGlvbnM6IFsnZXhlY3V0ZS1hcGk6TWFuYWdlQ29ubmVjdGlvbnMnXSxcbiAgICAgICAgICAgICAgICByZXNvdXJjZXM6IFtgYXJuOmF3czpleGVjdXRlLWFwaToke3RoaXMucmVnaW9ufToke3RoaXMuYWNjb3VudH06JHt3ZWJTb2NrZXRBcGkuYXBpSWR9L3Byb2QvKmBdLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGlucHV0VHlwZURldGVjdG9yID0gY3JlYXRlTGFtYmRhKCdJbnB1dFR5cGVEZXRlY3RvckZ1bmN0aW9uJywgJ2lucHV0LXR5cGUtZGV0ZWN0b3InLCA2MCk7XG4gICAgICAgIGNvbnN0IHNpdGVtYXBQYXJzZXIgPSBjcmVhdGVMYW1iZGEoJ1NpdGVtYXBQYXJzZXJGdW5jdGlvbicsICdzaXRlbWFwLXBhcnNlcicsIDEyMCk7XG4gICAgICAgIGNvbnN0IHNpdGVtYXBIZWFsdGhDaGVja2VyID0gY3JlYXRlTGFtYmRhKCdTaXRlbWFwSGVhbHRoQ2hlY2tlckZ1bmN0aW9uJywgJ3NpdGVtYXAtaGVhbHRoLWNoZWNrZXInLCAzMDAsIDI1Nik7XG4gICAgICAgIGNvbnN0IHVybFByb2Nlc3NvciA9IGNyZWF0ZUxhbWJkYSgnVVJMUHJvY2Vzc29yRnVuY3Rpb24nLCAndXJsLXByb2Nlc3NvcicsIDEyMCwgNTEyKTtcbiAgICAgICAgY29uc3Qgc3RydWN0dXJlRGV0ZWN0b3IgPSBjcmVhdGVMYW1iZGEoJ1N0cnVjdHVyZURldGVjdG9yRnVuY3Rpb24nLCAnc3RydWN0dXJlLWRldGVjdG9yJywgNjApO1xuXG4gICAgICAgIGNvbnN0IGRpbWVuc2lvbkFuYWx5emVyID0gY3JlYXRlTGFtYmRhKCdEaW1lbnNpb25BbmFseXplckZ1bmN0aW9uJywgJ2RpbWVuc2lvbi1hbmFseXplcicsIDMwMCwgNTEyLCB7XG4gICAgICAgICAgICBQUk9DRVNTRURfQ09OVEVOVF9UQUJMRTogcHJvY2Vzc2VkQ29udGVudFRhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICAgIENBQ0hFX1RUTF9EQVlTOiAnNydcbiAgICAgICAgfSk7XG4gICAgICAgIHByb2Nlc3NlZENvbnRlbnRUYWJsZS5ncmFudFJlYWRXcml0ZURhdGEoZGltZW5zaW9uQW5hbHl6ZXIpO1xuICAgICAgICBkaW1lbnNpb25BbmFseXplci5hZGRUb1JvbGVQb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgYWN0aW9uczogWydiZWRyb2NrOkludm9rZU1vZGVsJ10sXG4gICAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgY29uc3QgcmVwb3J0R2VuZXJhdG9yID0gY3JlYXRlTGFtYmRhKCdSZXBvcnRHZW5lcmF0b3JGdW5jdGlvbicsICdyZXBvcnQtZ2VuZXJhdG9yJywgNjAsIDI1Nik7XG4gICAgICAgIGNvbnN0IGlzc3VlRGlzY292ZXJlciA9IGNyZWF0ZUxhbWJkYSgnSXNzdWVEaXNjb3ZlcmVyRnVuY3Rpb24nLCAnaXNzdWUtZGlzY292ZXJlcicsIDEyMCwgNTEyLCB7IFMzX0JVQ0tFVF9OQU1FOiBhbmFseXNpc0J1Y2tldC5idWNrZXROYW1lIH0pO1xuICAgICAgICBjb25zdCBpc3N1ZVZhbGlkYXRvciA9IGNyZWF0ZUxhbWJkYSgnSXNzdWVWYWxpZGF0b3JGdW5jdGlvbicsICdpc3N1ZS12YWxpZGF0b3InLCAzMDAsIDEwMjQsIHsgUzNfQlVDS0VUX05BTUU6IGFuYWx5c2lzQnVja2V0LmJ1Y2tldE5hbWUgfSk7XG4gICAgICAgIGNvbnN0IGZpeEdlbmVyYXRvciA9IGNyZWF0ZUxhbWJkYSgnRml4R2VuZXJhdG9yRnVuY3Rpb24nLCAnZml4LWdlbmVyYXRvcicsIDMwMCwgMTAyNCk7XG4gICAgICAgIGNvbnN0IGZpeEFwcGxpY2F0b3IgPSBjcmVhdGVMYW1iZGEoJ0ZpeEFwcGxpY2F0b3JGdW5jdGlvbicsICdmaXgtYXBwbGljYXRvcicsIDMwMCwgNTEyKTtcblxuICAgICAgICBpc3N1ZVZhbGlkYXRvci5hZGRUb1JvbGVQb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgYWN0aW9uczogWydiZWRyb2NrOkludm9rZU1vZGVsJ10sXG4gICAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgZml4R2VuZXJhdG9yLmFkZFRvUm9sZVBvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICBhY3Rpb25zOiBbJ2JlZHJvY2s6SW52b2tlTW9kZWwnXSxcbiAgICAgICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyA1LiBTdGVwIEZ1bmN0aW9ucyBXb3JrZmxvd1xuICAgICAgICBjb25zdCBkZWZpbml0aW9uU3RyaW5nID0gYHtcIlN0YXJ0QXRcIjpcIkRldGVjdElucHV0VHlwZVwiLFwiU3RhdGVzXCI6e1wiRGV0ZWN0SW5wdXRUeXBlXCI6e1wiTmV4dFwiOlwiSW5wdXRUeXBlQ2hvaWNlXCIsXCJSZXRyeVwiOlt7XCJFcnJvckVxdWFsc1wiOltcIkxhbWJkYS5DbGllbnRFeGVjdXRpb25UaW1lb3V0RXhjZXB0aW9uXCIsXCJMYW1iZGEuU2VydmljZUV4Y2VwdGlvblwiLFwiTGFtYmRhLkFXU0xhbWJkYUV4Y2VwdGlvblwiLFwiTGFtYmRhLlNka0NsaWVudEV4Y2VwdGlvblwiXSxcIkludGVydmFsU2Vjb25kc1wiOjIsXCJNYXhBdHRlbXB0c1wiOjYsXCJCYWNrb2ZmUmF0ZVwiOjJ9XSxcIlR5cGVcIjpcIlRhc2tcIixcIlJlc3VsdFBhdGhcIjpcIiQuaW5wdXRUeXBlRGV0ZWN0b3JSZXN1bHRcIixcIlJlc291cmNlXCI6XCJhcm46YXdzOnN0YXRlczo6OmxhbWJkYTppbnZva2VcIixcIlBhcmFtZXRlcnNcIjp7XCJGdW5jdGlvbk5hbWVcIjpcIiR7aW5wdXRUeXBlRGV0ZWN0b3IuZnVuY3Rpb25Bcm59XCIsXCJQYXlsb2FkLiRcIjpcIiRcIn19LFwiSW5wdXRUeXBlQ2hvaWNlXCI6e1wiVHlwZVwiOlwiQ2hvaWNlXCIsXCJDaG9pY2VzXCI6W3tcIlZhcmlhYmxlXCI6XCIkLmlucHV0VHlwZURldGVjdG9yUmVzdWx0LlBheWxvYWQuaW5wdXRUeXBlXCIsXCJTdHJpbmdFcXVhbHNcIjpcInNpdGVtYXBcIixcIk5leHRcIjpcIlBhcnNlU2l0ZW1hcFwifV0sXCJEZWZhdWx0XCI6XCJQcm9jZXNzVVJMXCJ9LFwiUHJvY2Vzc1VSTFwiOntcIk5leHRcIjpcIkRldGVjdFN0cnVjdHVyZVwiLFwiUmV0cnlcIjpbe1wiRXJyb3JFcXVhbHNcIjpbXCJMYW1iZGEuQ2xpZW50RXhlY3V0aW9uVGltZW91dEV4Y2VwdGlvblwiLFwiTGFtYmRhLlNlcnZpY2VFeGNlcHRpb25cIixcIkxhbWJkYS5BV1NMYW1iZGFFeGNlcHRpb25cIixcIkxhbWJkYS5TZGtDbGllbnRFeGNlcHRpb25cIl0sXCJJbnRlcnZhbFNlY29uZHNcIjoyLFwiTWF4QXR0ZW1wdHNcIjo2LFwiQmFja29mZlJhdGVcIjoyfV0sXCJUeXBlXCI6XCJUYXNrXCIsXCJSZXN1bHRQYXRoXCI6XCIkLnVybFByb2Nlc3NvclJlc3VsdFwiLFwiUmVzb3VyY2VcIjpcImFybjphd3M6c3RhdGVzOjo6bGFtYmRhOmludm9rZVwiLFwiUGFyYW1ldGVyc1wiOntcIkZ1bmN0aW9uTmFtZVwiOlwiJHt1cmxQcm9jZXNzb3IuZnVuY3Rpb25Bcm59XCIsXCJQYXlsb2FkLiRcIjpcIiRcIn19LFwiRGV0ZWN0U3RydWN0dXJlXCI6e1wiTmV4dFwiOlwiQW5hbHl6ZURpbWVuc2lvbnNcIixcIlJldHJ5XCI6W3tcIkVycm9yRXF1YWxzXCI6W1wiTGFtYmRhLkNsaWVudEV4ZWN1dGlvblRpbWVvdXRFeGNlcHRpb25cIixcIkxhbWJkYS5TZXJ2aWNlRXhjZXB0aW9uXCIsXCJMYW1iZGEuQVdTTGFtYmRhRXhjZXB0aW9uXCIsXCJMYW1iZGEuU2RrQ2xpZW50RXhjZXB0aW9uXCJdLFwiSW50ZXJ2YWxTZWNvbmRzXCI6MixcIk1heEF0dGVtcHRzXCI6NixcIkJhY2tvZmZSYXRlXCI6Mn1dLFwiVHlwZVwiOlwiVGFza1wiLFwiUmVzdWx0UGF0aFwiOlwiJC5zdHJ1Y3R1cmVEZXRlY3RvclJlc3VsdFwiLFwiUmVzb3VyY2VcIjpcImFybjphd3M6c3RhdGVzOjo6bGFtYmRhOmludm9rZVwiLFwiUGFyYW1ldGVyc1wiOntcIkZ1bmN0aW9uTmFtZVwiOlwiJHtzdHJ1Y3R1cmVEZXRlY3Rvci5mdW5jdGlvbkFybn1cIixcIlBheWxvYWQuJFwiOlwiJFwifX0sXCJBbmFseXplRGltZW5zaW9uc1wiOntcIk5leHRcIjpcIkdlbmVyYXRlUmVwb3J0XCIsXCJSZXRyeVwiOlt7XCJFcnJvckVxdWFsc1wiOltcIkxhbWJkYS5DbGllbnRFeGVjdXRpb25UaW1lb3V0RXhjZXB0aW9uXCIsXCJMYW1iZGEuU2VydmljZUV4Y2VwdGlvblwiLFwiTGFtYmRhLkFXU0xhbWJkYUV4Y2VwdGlvblwiLFwiTGFtYmRhLlNka0NsaWVudEV4Y2VwdGlvblwiXSxcIkludGVydmFsU2Vjb25kc1wiOjIsXCJNYXhBdHRlbXB0c1wiOjYsXCJCYWNrb2ZmUmF0ZVwiOjJ9XSxcIlR5cGVcIjpcIlRhc2tcIixcIlJlc3VsdFBhdGhcIjpcIiQuZGltZW5zaW9uQW5hbHl6ZXJSZXN1bHRcIixcIlJlc291cmNlXCI6XCJhcm46YXdzOnN0YXRlczo6OmxhbWJkYTppbnZva2VcIixcIlBhcmFtZXRlcnNcIjp7XCJGdW5jdGlvbk5hbWVcIjpcIiR7ZGltZW5zaW9uQW5hbHl6ZXIuZnVuY3Rpb25Bcm59XCIsXCJQYXlsb2FkLiRcIjpcIiRcIn19LFwiR2VuZXJhdGVSZXBvcnRcIjp7XCJFbmRcIjp0cnVlLFwiUmV0cnlcIjpbe1wiRXJyb3JFcXVhbHNcIjpbXCJMYW1iZGEuQ2xpZW50RXhlY3V0aW9uVGltZW91dEV4Y2VwdGlvblwiLFwiTGFtYmRhLlNlcnZpY2VFeGNlcHRpb25cIixcIkxhbWJkYS5BV1NMYW1iZGFFeGNlcHRpb25cIixcIkxhbWJkYS5TZGtDbGllbnRFeGNlcHRpb25cIl0sXCJJbnRlcnZhbFNlY29uZHNcIjoyLFwiTWF4QXR0ZW1wdHNcIjo2LFwiQmFja29mZlJhdGVcIjoyfV0sXCJUeXBlXCI6XCJUYXNrXCIsXCJSZXN1bHRQYXRoXCI6XCIkLnJlcG9ydEdlbmVyYXRvclJlc3VsdFwiLFwiUmVzb3VyY2VcIjpcImFybjphd3M6c3RhdGVzOjo6bGFtYmRhOmludm9rZVwiLFwiUGFyYW1ldGVyc1wiOntcIkZ1bmN0aW9uTmFtZVwiOlwiJHtyZXBvcnRHZW5lcmF0b3IuZnVuY3Rpb25Bcm59XCIsXCJQYXlsb2FkLiRcIjpcIiRcIn19LFwiQ2hlY2tTaXRlbWFwSGVhbHRoXCI6e1wiTmV4dFwiOlwiR2VuZXJhdGVSZXBvcnRcIixcIlJldHJ5XCI6W3tcIkVycm9yRXF1YWxzXCI6W1wiTGFtYmRhLkNsaWVudEV4ZWN1dGlvblRpbWVvdXRFeGNlcHRpb25cIixcIkxhbWJkYS5TZXJ2aWNlRXhjZXB0aW9uXCIsXCJMYW1iZGEuQVdTTGFtYmRhRXhjZXB0aW9uXCIsXCJMYW1iZGEuU2RrQ2xpZW50RXhjZXB0aW9uXCJdLFwiSW50ZXJ2YWxTZWNvbmRzXCI6MixcIk1heEF0dGVtcHRzXCI6NixcIkJhY2tvZmZSYXRlXCI6Mn1dLFwiVHlwZVwiOlwiVGFza1wiLFwiUmVzdWx0UGF0aFwiOlwiJC5zaXRlbWFwSGVhbHRoQ2hlY2tlclJlc3VsdFwiLFwiUmVzb3VyY2VcIjpcImFybjphd3M6c3RhdGVzOjo6bGFtYmRhOmludm9rZVwiLFwiUGFyYW1ldGVyc1wiOntcIkZ1bmN0aW9uTmFtZVwiOlwiJHtzaXRlbWFwSGVhbHRoQ2hlY2tlci5mdW5jdGlvbkFybn1cIixcIlBheWxvYWQuJFwiOlwiJFwifX0sXCJQYXJzZVNpdGVtYXBcIjp7XCJOZXh0XCI6XCJDaGVja1NpdGVtYXBIZWFsdGhcIixcIlJldHJ5XCI6W3tcIkVycm9yRXF1YWxzXCI6W1wiTGFtYmRhLkNsaWVudEV4ZWN1dGlvblRpbWVvdXRFeGNlcHRpb25cIixcIkxhbWJkYS5TZXJ2aWNlRXhjZXB0aW9uXCIsXCJMYW1iZGEuQVdTTGFtYmRhRXhjZXB0aW9uXCIsXCJMYW1iZGEuU2RrQ2xpZW50RXhjZXB0aW9uXCJdLFwiSW50ZXJ2YWxTZWNvbmRzXCI6MixcIk1heEF0dGVtcHRzXCI6NixcIkJhY2tvZmZSYXRlXCI6Mn1dLFwiVHlwZVwiOlwiVGFza1wiLFwiUmVzdWx0UGF0aFwiOlwiJC5zaXRlbWFwUGFyc2VyUmVzdWx0XCIsXCJSZXNvdXJjZVwiOlwiYXJuOmF3czpzdGF0ZXM6OjpsYW1iZGE6aW52b2tlXCIsXCJQYXJhbWV0ZXJzXCI6e1wiRnVuY3Rpb25OYW1lXCI6XCIke3NpdGVtYXBQYXJzZXIuZnVuY3Rpb25Bcm59XCIsXCJQYXlsb2FkLiRcIjpcIiRcIn19fSxcIlRpbWVvdXRTZWNvbmRzXCI6OTAwfWA7XG5cbiAgICAgICAgY29uc3Qgc3RhdGVNYWNoaW5lID0gbmV3IHNmbi5TdGF0ZU1hY2hpbmUodGhpcywgJ0xlbnN5QW5hbHlzaXNXb3JrZmxvdycsIHtcbiAgICAgICAgICAgIGRlZmluaXRpb25Cb2R5OiBzZm4uRGVmaW5pdGlvbkJvZHkuZnJvbVN0cmluZyhkZWZpbml0aW9uU3RyaW5nKSxcbiAgICAgICAgICAgIHRpbWVvdXQ6IGNkay5EdXJhdGlvbi5taW51dGVzKDE1KSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gR3JhbnQgU3RlcCBGdW5jdGlvbnMgcGVybWlzc2lvbiB0byBpbnZva2UgYWxsIExhbWJkYSBmdW5jdGlvbnNcbiAgICAgICAgaW5wdXRUeXBlRGV0ZWN0b3IuZ3JhbnRJbnZva2Uoc3RhdGVNYWNoaW5lKTtcbiAgICAgICAgc2l0ZW1hcFBhcnNlci5ncmFudEludm9rZShzdGF0ZU1hY2hpbmUpO1xuICAgICAgICBzaXRlbWFwSGVhbHRoQ2hlY2tlci5ncmFudEludm9rZShzdGF0ZU1hY2hpbmUpO1xuICAgICAgICB1cmxQcm9jZXNzb3IuZ3JhbnRJbnZva2Uoc3RhdGVNYWNoaW5lKTtcbiAgICAgICAgc3RydWN0dXJlRGV0ZWN0b3IuZ3JhbnRJbnZva2Uoc3RhdGVNYWNoaW5lKTtcbiAgICAgICAgZGltZW5zaW9uQW5hbHl6ZXIuZ3JhbnRJbnZva2Uoc3RhdGVNYWNoaW5lKTtcbiAgICAgICAgcmVwb3J0R2VuZXJhdG9yLmdyYW50SW52b2tlKHN0YXRlTWFjaGluZSk7XG5cbiAgICAgICAgLy8gNi4gQVBJIEhhbmRsZXIgYW5kIEhUVFAgQVBJXG4gICAgICAgIGNvbnN0IGFwaUhhbmRsZXIgPSBjcmVhdGVMYW1iZGEoJ0FwaUhhbmRsZXJGdW5jdGlvbicsICdhcGktaGFuZGxlcicsIDMwLCAyNTYsIHtcbiAgICAgICAgICAgIFNUQVRFX01BQ0hJTkVfQVJOOiBzdGF0ZU1hY2hpbmUuc3RhdGVNYWNoaW5lQXJuLFxuICAgICAgICAgICAgSVNTVUVfRElTQ09WRVJFUl9GVU5DVElPTl9OQU1FOiBpc3N1ZURpc2NvdmVyZXIuZnVuY3Rpb25OYW1lLFxuICAgICAgICAgICAgSVNTVUVfVkFMSURBVE9SX0ZVTkNUSU9OX05BTUU6IGlzc3VlVmFsaWRhdG9yLmZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgIEZJWF9HRU5FUkFUT1JfRlVOQ1RJT05fTkFNRTogZml4R2VuZXJhdG9yLmZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgIEZJWF9BUFBMSUNBVE9SX0ZVTkNUSU9OX05BTUU6IGZpeEFwcGxpY2F0b3IuZnVuY3Rpb25OYW1lLFxuICAgICAgICB9KTtcblxuICAgICAgICBzdGF0ZU1hY2hpbmUuZ3JhbnRTdGFydEV4ZWN1dGlvbihhcGlIYW5kbGVyKTtcbiAgICAgICAgaXNzdWVEaXNjb3ZlcmVyLmdyYW50SW52b2tlKGFwaUhhbmRsZXIpO1xuICAgICAgICBpc3N1ZVZhbGlkYXRvci5ncmFudEludm9rZShhcGlIYW5kbGVyKTtcbiAgICAgICAgZml4R2VuZXJhdG9yLmdyYW50SW52b2tlKGFwaUhhbmRsZXIpO1xuICAgICAgICBmaXhBcHBsaWNhdG9yLmdyYW50SW52b2tlKGFwaUhhbmRsZXIpO1xuXG4gICAgICAgIGNvbnN0IGh0dHBBcGkgPSBuZXcgYXBpZ3d2Mi5IdHRwQXBpKHRoaXMsICdMZW5zeUh0dHBBcGknLCB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0xlbnN5IEhUVFAgQVBJJyxcbiAgICAgICAgICAgIGNvcnNQcmVmbGlnaHQ6IHtcbiAgICAgICAgICAgICAgICBhbGxvd09yaWdpbnM6IFsnKiddLFxuICAgICAgICAgICAgICAgIGFsbG93TWV0aG9kczogW2FwaWd3djIuQ29yc0h0dHBNZXRob2QuR0VULCBhcGlnd3YyLkNvcnNIdHRwTWV0aG9kLlBPU1QsIGFwaWd3djIuQ29yc0h0dHBNZXRob2QuT1BUSU9OU10sXG4gICAgICAgICAgICAgICAgYWxsb3dIZWFkZXJzOiBbJ0NvbnRlbnQtVHlwZScsICdYLUFtei1EYXRlJywgJ0F1dGhvcml6YXRpb24nLCAnWC1BcGktS2V5J10sXG4gICAgICAgICAgICAgICAgbWF4QWdlOiBjZGsuRHVyYXRpb24uZGF5cygxMCksXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBhcGlJbnRlZ3JhdGlvbiA9IG5ldyBhcGlnd3YyX2ludGVncmF0aW9ucy5IdHRwTGFtYmRhSW50ZWdyYXRpb24oJ0FwaUhhbmRsZXJJbnRlZ3JhdGlvbicsIGFwaUhhbmRsZXIpO1xuXG4gICAgICAgIGh0dHBBcGkuYWRkUm91dGVzKHsgcGF0aDogJy9hbmFseXplJywgbWV0aG9kczogW2FwaWd3djIuSHR0cE1ldGhvZC5QT1NUXSwgaW50ZWdyYXRpb246IGFwaUludGVncmF0aW9uIH0pO1xuICAgICAgICBodHRwQXBpLmFkZFJvdXRlcyh7IHBhdGg6ICcvc2Nhbi1kb2MnLCBtZXRob2RzOiBbYXBpZ3d2Mi5IdHRwTWV0aG9kLlBPU1RdLCBpbnRlZ3JhdGlvbjogYXBpSW50ZWdyYXRpb24gfSk7XG4gICAgICAgIGh0dHBBcGkuYWRkUm91dGVzKHsgcGF0aDogJy9zdGF0dXMve3Nlc3Npb25JZH0nLCBtZXRob2RzOiBbYXBpZ3d2Mi5IdHRwTWV0aG9kLkdFVF0sIGludGVncmF0aW9uOiBhcGlJbnRlZ3JhdGlvbiB9KTtcbiAgICAgICAgaHR0cEFwaS5hZGRSb3V0ZXMoeyBwYXRoOiAnL2Rpc2NvdmVyLWlzc3VlcycsIG1ldGhvZHM6IFthcGlnd3YyLkh0dHBNZXRob2QuUE9TVF0sIGludGVncmF0aW9uOiBhcGlJbnRlZ3JhdGlvbiB9KTtcbiAgICAgICAgaHR0cEFwaS5hZGRSb3V0ZXMoeyBwYXRoOiAnL3ZhbGlkYXRlLWlzc3VlcycsIG1ldGhvZHM6IFthcGlnd3YyLkh0dHBNZXRob2QuUE9TVF0sIGludGVncmF0aW9uOiBhcGlJbnRlZ3JhdGlvbiB9KTtcbiAgICAgICAgaHR0cEFwaS5hZGRSb3V0ZXMoeyBwYXRoOiAnL2dlbmVyYXRlLWZpeGVzJywgbWV0aG9kczogW2FwaWd3djIuSHR0cE1ldGhvZC5QT1NUXSwgaW50ZWdyYXRpb246IGFwaUludGVncmF0aW9uIH0pO1xuICAgICAgICBodHRwQXBpLmFkZFJvdXRlcyh7IHBhdGg6ICcvYXBwbHktZml4ZXMnLCBtZXRob2RzOiBbYXBpZ3d2Mi5IdHRwTWV0aG9kLlBPU1RdLCBpbnRlZ3JhdGlvbjogYXBpSW50ZWdyYXRpb24gfSk7XG5cbiAgICAgICAgLy8gNy4gT3V0cHV0c1xuICAgICAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnSHR0cEFwaVVybCcsIHtcbiAgICAgICAgICAgIHZhbHVlOiBodHRwQXBpLmFwaUVuZHBvaW50LFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdIVFRQIEFQSSBHYXRld2F5IFVSTCcsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdXZWJTb2NrZXRBcGlVcmwnLCB7XG4gICAgICAgICAgICB2YWx1ZTogd2ViU29ja2V0U3RhZ2UudXJsLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdXZWJTb2NrZXQgQVBJIFVSTCcsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdTdGF0ZU1hY2hpbmVBcm4nLCB7XG4gICAgICAgICAgICB2YWx1ZTogc3RhdGVNYWNoaW5lLnN0YXRlTWFjaGluZUFybixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnU3RlcCBGdW5jdGlvbnMgU3RhdGUgTWFjaGluZSBBUk4nLFxuICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=